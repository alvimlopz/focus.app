<div class="modal-overlay" (click)="close()">
  <div class="modal-music" (click)="$event.stopPropagation()">
    
    <div class="header">
      <i class="bi bi-music-note-beamed"></i>
      <span>Música</span>
      <button class="btn-close" (click)="close()">✖</button>
    </div>

    <div class="tabs">
      <button [class.active]="activeTab === 'spotify'" (click)="activeTab = 'spotify'">Spotify player</button>
      <button [class.active]="activeTab === 'native'" (click)="activeTab = 'native'">Native player</button>
    </div>

<!-- Lista de playlists -->
<div class="playlist-cards">
  <div class="card" *ngFor="let playlist of spotifyPlaylists" (click)="selectSpotify(playlist)">
    <img [src]="playlist.image" alt="{{ playlist.name }}">
    <p>{{ playlist.name }}</p>
  </div>
</div>

<!-- Player Spotify -->
<div class="player-preview" *ngIf="selectedSpotify">
  <iframe
    [src]="getSafeUrl(selectedSpotify.url)"
    width="100%"
    height="380"
    frameborder="0"
    allowtransparency="true"
    allow="autoplay; clipboard-write; encrypted-media; fullscreen; picture-in-picture">
  </iframe>
</div>


    <!-- Native -->
    <div *ngIf="activeTab === 'native'">
      <div class="playlist-cards">
        <div class="card" *ngFor="let playlist of nativePlaylists" (click)="selectNative(playlist)">
          <img [src]="playlist.image" alt="">
          <p>{{ playlist.name }}</p>
        </div>
      </div>

      <div class="player-controls" *ngIf="selectedNative">
        <img [src]="selectedNative.image" alt="">
        <p class="title">{{ selectedNative.name }}</p>

        <audio #audio controls (ended)="nextTrack()" [src]="currentTrack?.url"></audio>

        <div class="track-list">
          <div *ngFor="let track of selectedNative.tracks; let i = index"
            [class.active]="i === currentTrackIndex"
            (click)="playTrack(i)">
            {{ i + 1 }}. {{ track.name }} <span>{{ track.duration }}</span>
          </div>
        </div>
      </div>
    </div>

  </div>
</div>
